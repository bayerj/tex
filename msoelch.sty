\NeedsTeXFormat{LaTeX2e}%[2015/01/01] % fixed via latexrelease package, see below
\ProvidesPackage{msoelch}[2016/06/16 custom frequently used commands]

\usepackage{xparse} % necessary for hacking overloaded commands and iterating overlists
\usepackage{xspace}
\usepackage{mleftright} % for nicer spacing before \left in the presence of indices

\definecolor{tumblau}{RGB}{0,101,189}

% Convenient macros with correct spacing
\newcommand{\wrt}{w.\,r.\,t.\@\xspace}
\newcommand{\ie}{i.\,e.,\@\xspace}
\newcommand{\Ie}{I.\,e.,\@\xspace}
\newcommand{\eg}{e.\,g.,\@\xspace}
\newcommand{\Eg}{E.\,g.,\@\xspace}
\makeatletter
\newcommand*{\etc}{%
    \@ifnextchar{.}%
        {etc}%
        {etc.\@\xspace}%
}
\makeatother


% Math macros
\newcommand{\NN}{\ensuremath{\mathbb{N}}}
\newcommand{\RR}{\ensuremath{\mathbb{R}}}
\newcommand{\PP}{\ensuremath{\mathbb{P}}}
\newcommand{\EE}{\ensuremath{\mathbb{E}}}

\newcommand{\mcX}{\ensuremath{\mathcal{X}}}
\newcommand{\mcU}{\ensuremath{\mathcal{U}}}
\newcommand{\mcZ}{\ensuremath{\mathcal{Z}}}

\newcommand{\shallbe}{\;{\overset{!}=}\;}
\newcommand{\dint}{\,\mathrm d}
\newcommand{\abs}[1]{{\left\lvert#1\right\rvert}}
\newcommand{\set}[1]{{\left\{#1\right\}}}
\newcommand{\interval}[1]{{\left[#1\right]}}
\newcommand{\gauss}[1]{{\ensuremath{\mathcal{N}\mleft(#1\mright)}}}
\newcommand{\kl}[2]{\ensuremath{\operatorname{KL}\mleft(#1\mid\mid#2\mright)}}
\newcommand{\loss}[2][]{\ensuremath{\mathcal{L}_{#1}\mleft(#2\mright)}}


% add macros for time indices and include bold versions for vectors/matrices
\newcommand{\Mkt}[1]{\expandafter\def\csname #1t\endcsname{\ensuremath{#1_t}}}
\newcommand{\MkT}[1]{\expandafter\def\csname #1T\endcsname{\ensuremath{#1_T}}}
\newcommand{\Mkts}[1]{\expandafter\def\csname #1ts\endcsname{\ensuremath{#1_{1:t}}}}
\newcommand{\MkTs}[1]{\expandafter\def\csname #1Ts\endcsname{\ensuremath{#1_{1:T}}}}

\newcommand{\MkVec}[1]{\expandafter\def\csname b#1\endcsname{\ensuremath{\mathbf{#1}}}}
\newcommand{\MktVec}[1]{\expandafter\def\csname b#1t\endcsname{\ensuremath{\mathbf{#1}_t}}}
\newcommand{\MkTVec}[1]{\expandafter\def\csname b#1T\endcsname{\ensuremath{\mathbf{#1}_T}}}
\newcommand{\MktsVec}[1]{\expandafter\def\csname b#1ts\endcsname{\ensuremath{\mathbf{#1}_{1:t}}}}
\newcommand{\MkTsVec}[1]{\expandafter\def\csname b#1Ts\endcsname{\ensuremath{\mathbf{#1}_{1:T}}}}

\newcommand{\varmacros}[1]{\Mkt{#1} \MkT{#1} \Mkts{#1} \MkTs{#1} \MkVec{#1} \MktVec{#1} \MkTVec{#1} \MktsVec{#1} \MkTsVec{#1}}

% iteration over list stolen from http://tex.stackexchange.com/questions/159118/how-to-iterate-over-a-comma-separated-list
\ExplSyntaxOn
\NewDocumentCommand{\variables}{ m }{\clist_map_inline:nn { #1 } { \varmacros{##1} }}
\ExplSyntaxOff

% dynamically create overloaded command for probability distributions
% mandatory argument is the argument of the distribution, e.g.,
% \MkProbDist{p} implies \p{x}
% first optional argument is a conditional, second optional argument parametrizes the distribution as a subscript

% define if statement that defaults to false even when the argument is just empty
% this way, the overloaded function may be used with the third argument only with a different layout (e.g., if no argument is supplied, no brackets are needed)
\makeatletter 
\newcommand{\IfNoValueOrEmptyTF}[3] {\IfNoValueTF{#1}{#2}{\def\@tempa{#1}\ifx\@tempa\@empty#2\else#3\fi}}
\makeatother 

\newcommand{\MkProbDist}[1]{
\expandafter\ProvideDocumentCommand\csname #1\endcsname{G{}G{}G{}}{}
\expandafter\RenewDocumentCommand\csname #1\endcsname{G{}G{}G{}}{\ensuremath{#1\IfNoValueOrEmptyTF{##3}{}{_{##3}}\IfNoValueOrEmptyTF{##1}{}{\mleft(##1 \IfNoValueOrEmptyTF{##2}{}{\mid ##2}\mright)}}}}
\ExplSyntaxOn
\NewDocumentCommand{\probdists}{ m }{\clist_map_inline:nn { #1 } { \MkProbDist{##1} }}
\ExplSyntaxOff

% overloaded command for expected value
\NewDocumentCommand\expc{G{}G{}G{}}{\ensuremath{\mathbb{E}\IfNoValueOrEmptyTF{#3}{}{_{#3}}\IfNoValueOrEmptyTF{#1}{}{\mleft[#1 \IfNoValueOrEmptyTF{#2}{}{\mid #2}\mright]}}}

% overloaded command for variance
\NewDocumentCommand\var{G{}G{}G{}}{\ensuremath{\operatorname{Var}\IfNoValueOrEmptyTF{#3}{}{_{#3}}\IfNoValueOrEmptyTF{#1}{}{\mleft[#1 \IfNoValueOrEmptyTF{#2}{}{\mid #2}\mright]}}}





